<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Stats Dashboard</title>
    <link rel="stylesheet" href="./css/output.css">
    <link rel="icon" type="image/svg" href="./assets/leetcode.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl md:text-5xl font-bold text-center mb-8 text-white drop-shadow-lg">LeetCode Stats Dashboard</h1>
        <div class="mb-8 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <input type="text" id="username" placeholder="Enter LeetCode username" class="px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-300 glassmorphism text-white placeholder-gray-300 w-full sm:w-64">
            <button id="fetchStats" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-full hover:from-indigo-700 hover:to-purple-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:ring-opacity-50 shadow-lg">
                Fetch Stats
            </button>
        </div>
        <div id="loadingIndicator" class="hidden text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-white"></div>
        </div>
        <div id="statsContainer" class="hidden opacity-0 transition-opacity duration-500">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="col-span-1 md:col-span-2 lg:col-span-3 glassmorphism rounded-xl shadow-lg p-6 transform hover:scale-102 transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-white">User Statistics</h2>
                    <div class="flex flex-wrap justify-around items-center" id="userStats"></div>
                </div>
                <div class="glassmorphism rounded-xl shadow-lg p-6 transform hover:scale-102 transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-white">Solved Questions</h2>
                    <div id="solvedChart"></div>
                </div>
                <div class="glassmorphism rounded-xl shadow-lg p-6 transform hover:scale-102 transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-white">Total Questions</h2>
                    <div id="totalChart"></div>
                </div>
                <div class="glassmorphism rounded-xl shadow-lg p-6 transform hover:scale-102 transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-white">Solving Progress</h2>
                    <div id="progressChart"></div>
                </div>
                <div class="col-span-1 md:col-span-2 lg:col-span-3 glassmorphism rounded-xl shadow-lg p-6 transform hover:scale-102 transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-white">Solved vs Total Questions</h2>
                    <div id="comparisonChart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- <script src="script.js"></script> -->
    <script>
        let solvedChart, totalChart, progressChart, comparisonChart;

const fetchStatsButton = document.getElementById('fetchStats');
const usernameInput = document.getElementById('username');
const statsContainer = document.getElementById('statsContainer');
const loadingIndicator = document.getElementById('loadingIndicator');

fetchStatsButton.addEventListener('click', fetchStats);

async function fetchStats() {
    let username = usernameInput.value;
    if (!username) {
        alert('Enter a username to proceed');
        return;
    }

    loadingIndicator.classList.remove('hidden');
    statsContainer.classList.add('hidden');

    try {
        const URL = `https://leetcode-api-faisalshohag.vercel.app/${username.trim()}`;
        const data = await fetch(URL);
        const response = await data.json();

        updateUI(response);
        usernameInput.value = ''; // Clear the input field after fetching stats
    } catch (error) {
        console.error('Error fetching stats:', error);
    } finally {
        loadingIndicator.classList.add('hidden');
    }
}

function updateUI(data) {
    statsContainer.classList.remove('hidden');
    setTimeout(() => {
        statsContainer.style.opacity = '1';
    }, 50);

    updateUserStats(data);
    createSolvedChart(data);
    createTotalChart(data);
    createProgressChart(data);
    createComparisonChart(data);
}

function updateUserStats(data) {
    const userStatsContainer = document.getElementById('userStats');
    userStatsContainer.innerHTML = ''; // Clear the previous stats
    const stats = [
        { label: 'Ranking', value: data.ranking },
        { label: 'Reputation', value: data.reputation },
        { label: 'Contribution Points', value: data.contributionPoint }
    ];

    stats.forEach(stat => {
        const statElement = document.createElement('div');
        statElement.className = 'flex flex-col items-center m-2 p-4 bg-white bg-opacity-20 rounded-lg';
        statElement.innerHTML = `
            <span class="text-2xl font-bold text-white">${stat.value}</span>
            <span class="text-sm text-gray-200">${stat.label}</span>
        `;
        userStatsContainer.appendChild(statElement);
    });
}

function createSolvedChart(data) {
    if (solvedChart) solvedChart.destroy(); // Destroy existing chart

    const options = {
        series: [data.easySolved, data.mediumSolved, data.hardSolved],
        chart: {
            type: 'donut',
            height: 350
        },
        labels: ['Easy', 'Medium', 'Hard'],
        colors: ['#4ade80', '#fbbf24', '#f87171'],
        plotOptions: {
            pie: {
                donut: {
                    labels: {
                        show: true,
                        total: {
                            show: true,
                            label: 'Total Solved',
                            color: '#fff'
                        }
                    }
                }
            }
        },
        dataLabels: {
            enabled: true,
            style: {
                colors: ['#111']
            }
        },
        legend: {
            position: 'bottom',
            labels: {
                colors: '#fff'
            }
        }
    };

    solvedChart = new ApexCharts(document.querySelector("#solvedChart"), options);
    solvedChart.render();
}

function createTotalChart(data) {
    if (totalChart) totalChart.destroy(); // Destroy existing chart

    const options = {
        series: [data.totalEasy, data.totalMedium, data.totalHard],
        chart: {
            type: 'pie',
            height: 350
        },
        labels: ['Easy', 'Medium', 'Hard'],
        colors: ['#60a5fa', '#818cf8', '#a78bfa'],
        dataLabels: {
            enabled: true,
            style: {
                colors: ['#111']
            }
        },
        legend: {
            position: 'bottom',
            labels: {
                colors: '#fff'
            }
        }
    };

    totalChart = new ApexCharts(document.querySelector("#totalChart"), options);
    totalChart.render();
}

function createProgressChart(data) {
    if (progressChart) progressChart.destroy(); // Destroy existing chart

    const options = {
        series: [{
            name: 'Progress',
            data: [
                (data.easySolved / data.totalEasy) * 100,
                (data.mediumSolved / data.totalMedium) * 100,
                (data.hardSolved / data.totalHard) * 100
            ]
        }],
        chart: {
            height: 350,
            type: 'radar'
        },
        xaxis: {
            categories: ['Easy', 'Medium', 'Hard'],
            labels: {
                style: {
                    colors: '#fff'
                }
            }
        },
        yaxis: {
            labels: {
                formatter: function(val) {
                    return val.toFixed(0) + '%';
                },
                style: {
                    colors: '#fff'
                }
            }
        },
        fill: {
            opacity: 0.5,
            colors: ['#8b5cf6']
        },
        stroke: {
            show: true,
            width: 2,
            colors: ['#8b5cf6'],
            dashArray: 0
        },
        markers: {
            size: 5,
            colors: ['#8b5cf6'],
            strokeColor: '#fff',
            strokeWidth: 2,
        }
    };

    progressChart = new ApexCharts(document.querySelector("#progressChart"), options);
    progressChart.render();
}

function createComparisonChart(data) {
    if (comparisonChart) comparisonChart.destroy(); // Destroy existing chart

    const options = {
        series: [{
            name: 'Solved',
            data: [data.easySolved, data.mediumSolved, data.hardSolved]
        }, {
            name: 'Total',
            data: [data.totalEasy, data.totalMedium, data.totalHard]
        }],
        chart: {
            type: 'bar',
            height: 350,
            stacked: true,
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '55%',
                endingShape: 'rounded'
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            show: true,
            width: 2,
            colors: ['transparent']
        },
        xaxis: {
            categories: ['Easy', 'Medium', 'Hard'],
            labels: {
                style: {
                    colors: '#fff'
                }
            }
        },
        yaxis: {
            title: {
                text: 'Number of Questions',
                style: {
                    color: '#fff'
                }
            },
            labels: {
                style: {
                    colors: '#fff'
                }
            }
        },
        fill: {
            opacity: 1
        },
        tooltip: {
            y: {
                formatter: function (val) {
                    return val + " questions"
                }
            }
        },
        legend: {
            position: 'top',
            labels: {
                colors: '#fff'
            }
        },
        colors: ['#60a5fa', '#f472b6']
    };

    comparisonChart = new ApexCharts(document.querySelector("#comparisonChart"), options);
    comparisonChart.render();
}

    </script>
</body>
</html>